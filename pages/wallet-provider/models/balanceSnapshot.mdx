# BalanceSnapshot

Stores User token balance entries

## Schema

- `id` : ID
- `prevId` : ID ([BalanceSnapshot](./balanceSnapshot))
- `userId` : ID ([User](./user))
- `tokenId`: ID ([Token](./token))
- `settlementId` : ID ([Settlement](./settlement))
- `amount` : Numeric (UNSIGNED)
- `delta`: Numeric (SIGNED)

## Relations

- [BalanceSnapshot](./balanceSnapshot) - ONE
- [User](./user) - ONE
- [Token](./token) - ONE
- [Settlement](./settlement) - ONE

```prisma

model BalanceSnapshot {
  id           String   @id @default(uuid())
  prevId       String?
  userId       String
  tokenId      String
  settlementId String
  amount       Decimal
  delta        Decimal

  prevSnapshot BalanceSnapshot? @relation("BalanceSnapshotsToPrevSnapshot", fields: [prevId], references: [id])
  user         User @relation(fields: [userId], references: [id])
  token        Token @relation(fields: [tokenId], references: [id])
  settlement   Settlement @relation(fields: [settlementId], references: [id])

  @@index([prevId], name: "idx_balancesnapshot_previd")
  @@index([userId], name: "idx_balancesnapshot_userid")
  @@index([tokenId], name: "idx_balancesnapshot_tokenid")
  @@index([settlementId], name: "idx_balancesnapshot_settlementid")
  @@unique([tokenId, userId, prevId], name: "unique_idx_balancesnapshot_tokenid_userid_previd")
}
```
